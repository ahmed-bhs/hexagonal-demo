parameters: null
services:
    _defaults:
        autowire: true
        autoconfigure: true
    App\:
        resource: ../src/
        exclude:
            - ../src/DependencyInjection/
            - ../src/Entity/
            - ../src/Kernel.php
            - ../src/Cadeau/Attribution/Domain/Model/
            - ../src/Cadeau/Attribution/Domain/ValueObject/
    App\Cadeau\Attribution\UI\Http\Web\Controller\ListHabitantsController:
        arguments:
            $queryBus: '@query.bus'

    # Port → Adapter bindings (Hexagonal Architecture)
    # These bindings connect Domain ports (interfaces) to Infrastructure adapters (implementations)

    # ID Generation Port (Shared)
    App\Shared\Domain\Port\IdGeneratorInterface:
        class: App\Shared\Infrastructure\Generator\UuidV7Generator
        # ✅ Using UUID v7 (time-ordered, better for database performance)
        # Can be swapped for:
        # - UlidGenerator (lexicographically sortable)
        # - SnowflakeGenerator (distributed systems)
        # - FakeIdGenerator (deterministic testing)

    # Repository Ports
    App\Cadeau\Attribution\Domain\Port\HabitantRepositoryInterface:
        class: App\Cadeau\Attribution\Infrastructure\Persistence\Doctrine\DoctrineHabitantRepository
    App\Cadeau\Attribution\Domain\Port\CadeauRepositoryInterface:
        class: App\Cadeau\Attribution\Infrastructure\Persistence\Doctrine\DoctrineCadeauRepository
    App\Cadeau\Attribution\Domain\Port\AttributionRepositoryInterface:
        class: App\Cadeau\Attribution\Infrastructure\Persistence\Doctrine\DoctrineAttributionRepository
    App\Cadeau\Demande\Domain\Port\DemandeCadeauRepositoryInterface:
        class: App\Cadeau\Demande\Infrastructure\Persistence\Doctrine\DoctrineDemandeCadeauRepository

    # Validation Port Implementations

    # Validateur pur PHP (pour AttribuerCadeauxCommand)
    App\Cadeau\Attribution\Application\AttribuerCadeaux\AttribuerCadeauxCommandValidator: ~

    App\Cadeau\Attribution\Application\AttribuerCadeaux\AttribuerCadeauxCommandHandler:
        arguments:
            $validator: '@App\Cadeau\Attribution\Application\AttribuerCadeaux\AttribuerCadeauxCommandValidator'

    # Adaptateur Symfony Validator (pour commands avec contraintes Symfony)
    App\Shared\Infrastructure\Validation\SymfonyValidatorAdapter:
        arguments:
            $validator: '@validator'

    App\Cadeau\Demande\Application\SoumettreDemandeCadeau\SoumettreDemandeCadeauCommandHandler:
        arguments:
            $validator: '@App\Shared\Infrastructure\Validation\SymfonyValidatorAdapter'
